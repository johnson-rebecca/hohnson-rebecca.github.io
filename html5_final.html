<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CSS3 using JS &amp; HTML5 tags for media</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
<link href='https://fonts.googleapis.com/css?family=Fascinate' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Arsenal' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Sarpanch' rel='stylesheet'>
<style>
body{
	font-family: 'Arsenal';
	overflow-x: hidden;
}
.img{
	position:absolute;z-index:20;
}

#container{
    display:inline-block;
    width:381px; 
    height:360px;
    margin: 0 auto; 
    position:relative; 
    border-radius: 10px; 
}

#videoPlayer{
    position:relative;
    z-index:1;
}
#tv_frame {
	position:absolute;
	z-index:20;
}
.center {
	text-align: center;
}
#radioDiv {
	width:50%;
	max-width: 400px;
	display:inline-block;
}
h1 {
	font-family: "Times New Roman", Times, serif;
	color: #000000;
}
.hide {
	display: none;
}
.center {
	text-align:center;
}

.button_retro{
 border:1px solid #ffc826; 
 -webkit-border-radius: 21px; 
 -moz-border-radius: 21px;
 border-radius: 21px;
 font-size:12px;
 font-family:arial, helvetica, sans-serif; 
 padding: 10px 10px 10px 10px; 
 text-decoration:none; 
 display:inline-block;
 text-shadow: -1px -1px 0 rgba(252,252,252,0.3);
 font-weight:bold; 
 color: #404040;
 background-color: #ffd65e !important; 
 background-image: -webkit-gradient(linear, left top, left bottom, from(#ffd65e), to(#febf04));
 background-image: -webkit-linear-gradient(top, #ffd65e, #febf04);
 background-image: -moz-linear-gradient(top, #ffd65e, #febf04);
 background-image: -ms-linear-gradient(top, #ffd65e, #febf04);
 background-image: -o-linear-gradient(top, #ffd65e, #febf04);
 background-image: linear-gradient(to bottom, #ffd65e, #febf04);filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=#ffd65e, endColorstr=#febf04);
}

.button_retro:hover{
 border:1px solid #f7b800;
 background-color: #ffc92b !important; 
 background-image: -webkit-gradient(linear, left top, left bottom, from(#ffc92b), to(#ce9a01));
 background-image: -webkit-linear-gradient(top, #ffc92b, #ce9a01);
 background-image: -moz-linear-gradient(top, #ffc92b, #ce9a01);
 background-image: -ms-linear-gradient(top, #ffc92b, #ce9a01);
 background-image: -o-linear-gradient(top, #ffc92b, #ce9a01);
 background-image: linear-gradient(to bottom, #ffc92b, #ce9a01);filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=#ffc92b, endColorstr=#ce9a01);
}

/* General button style (reset) */
.btn {
	border: none;
	font-family: inherit;
	font-size: inherit;
	color: inherit;
	background: transparent;
	cursor: pointer;
	padding: 5px 10px;
	display: inline-block;
	margin: 5px 2px;
	letter-spacing: 1px;
	outline: none;
	position: relative;
	-webkit-transition: all 0.3s;
	-moz-transition: all 0.3s;
	transition: all 0.3s;
}

.btn:after {
	content: '';
	position: absolute;
	z-index: -1;
	-webkit-transition: all 0.3s;
	-moz-transition: all 0.3s;
	transition: all 0.3s;
}
/* Button 1 */
.btn-1 {
	border: 2px solid #46b6fe;
	color: #46b6fe;
}

/* Button 1a */
.btn-1a:hover,
.btn-1a:active {
	color: #0e83cd;
}
/* Button modern */
.btn-modern {
	overflow: hidden;
}

.btn-modern:after {
	width: 90%;
	height: 0;
	top: 50%;
	left: 50%;
	background: #8ee3ff;
	opacity: 0;
	-webkit-transform: translateX(-50%) translateY(-50%) rotate(20deg);
	-moz-transform: translateX(-50%) translateY(-50%) rotate(20deg);
	-ms-transform: translateX(-50%) translateY(-50%) rotate(20deg);
	transform: translateX(-50%) translateY(-50%) rotate(20deg);
}
.btn-modern:hover,
.btn-modern:active {
	color: #fff;
}

.btn-modern:hover:after {
	height: 260%;
	opacity: 1;
}

.btn-modern:active:after {
	height: 400%;
	opacity: 1;
}
#tvControlsContainer {
	width: 640px;
	text-align: center;
}
#tvControls {
	float: right;
	display:inline-block;
}
#divAudioPlayer {
	position: absolute;
	top: 0;
	right: -300px;
	transition: right .4s;
}
.slideIn {
	right:0px !important;
}
#slider_icon {
	color: #808080 ;
	font-size: 60px;
	display:inline-block;
	position: absolute;
	top: 0;
	right: 0px;
	transition: right .4s;
}
.slideIn_icon {
	right:300px !important;
}
</style>
</head>

<body>
<div style="font-family: 'Pattaya';"> </div>
<h1 id="pageTitle" class="center">Topics: 7 - CSS3 using JS & 10 - HTML5 tags for media</h1>
<div class="center">
	<canvas id="cvs_pageTitleRetro" class="hide" width="600" height="125"></canvas>
	<canvas id="cvs_pageTitleModern" class="hide" width="600" height="125"></canvas>
</div>
<div class="center">
	<div id="radioDiv" class="center">
		<input type="radio" id="styleRetro" name="displayStyle" value="retro"> Retro
	  <input type="radio" id="styleModern" name="displayStyle" value="modern"> Modern
	  <input type="radio" id="styleOther" name="displayStyle" value="other" checked> None
	</div>
</div>

<div id="container">
	<div id="tv_frame"></div>
   <video id='videoPlayer'>
       <source id='mp4Source' src="http://media2.ldscdn.org/assets/mormon-channel/mormon-messages-2018/2018-01-0010-discovering-truth-360p-eng.mp4" type="video/mp4" />
    </video>
		<input id="channelNumber" type="hidden" value="1"/>
	<br/>
	
</div>
<div id="tvControlsContainer">
<div id="tvControls">
	<button id="tv_back" class="" onclick="changeChannel(false);"><i class="fa fa-backward"></i></button>
	<button id="tv_playpause" class="" onclick="playPause()"><i class="fa fa-play"></i><i class="fa fa-pause"></i></button> 
	<button id="tv_fore" class="" onclick="changeChannel(true);"><i class="fa fa-forward"></i></button>
</div>
</div>

<div id="audioContainer">
	<i id="slider_icon" class="fa fa-angle-double-left" onclick="toggleAudio();"></i>
	<div id="divAudioPlayer">
		<audio controls>
		  <source src="http://broadcast.lds.org/yw/selected/YWSelected_11_IWalkByFaith_eng.mp3" type="audio/mpeg">
		Your browser does not support the audio element.
		</audio>
	</div>
</div>

<script>
WebFont.load({
    google: {
      families: ['Pattaya:400,700', 'Six Caps:400,700']
    }
  });


var programs = [];
window.addEventListener("load", loadPage);

function loadPage(){
	//build array 
	programs = [
		"http://media2.ldscdn.org/assets/mormon-channel/mormon-messages-2018/2018-01-0010-discovering-truth-360p-eng.mp4",
		"http://media2.ldscdn.org/assets/mormon-channel/mormon-messages-2018/2018-01-0020-spiritual-dynamite-1080p-eng.mp4",
		"http://media2.ldscdn.org/assets/mormon-channel/mormon-messages-2016/2016-11-5000-the-journey-360p-eng.mp4",
		"http://media2.ldscdn.org/assets/mormon-channel/mormon-messages-2019/2019-01-0010-migration-a-yearning-for-home-1080p-eng.mp4",	
		"http://media2.ldscdn.org/assets/mormon-channel/mormon-messages-2018/2018-01-0060-reach-up-to-him-in-faith-360p-eng.mp4",
		"http://media2.ldscdn.org/assets/mormon-channel/mormon-messages-2017/2017-01-009-a-good-samaritan-1080p-eng.mp4",
		"http://media2.ldscdn.org/assets/mormon-channel/mormon-messages-2018/2018-01-0180-samuel-and-the-star-360p-eng.mp4",
		"http://media2.ldscdn.org/assets/mormon-channel/mormon-messages-2015/2015-03-009-a-shower-of-heavenly-blessings-360p-eng.mp4",
		"http://media2.ldscdn.org/assets/mormon-channel/mormon-messages-2018/2018-01-0120-songs-sung-and-unsung-360p-eng.mp4",
		"http://media2.ldscdn.org/assets/mormon-channel/mormon-messages-2017/2017-01-003-spiritual-whirlwinds-360p-eng.mp4"
	];
	
	document.getElementById('styleRetro').setAttribute('onchange','changeStyle();');
	document.getElementById('styleModern').setAttribute('onchange','changeStyle();');
	document.getElementById('styleOther').setAttribute('onchange','changeStyle();');
	//drawRetroTitle();
}

function toggleAudio(){
	document.getElementById('divAudioPlayer').classList.toggle('slideIn');
	var icon = document.getElementById('slider_icon');
	icon.classList.toggle('fa-angle-double-left');
	icon.classList.toggle('fa-angle-double-right');
	icon.classList.toggle('slideIn_icon');
}

function changeStyle() {
	var selOpt;
	var els = document.getElementsByName('displayStyle');
	var div = document.getElementById('tv_frame');
	var video = document.getElementById('videoPlayer');

	for (var i = 0; i < els.length;i++){
	  if ( els[i].checked ) {
		selOpt = els[i].value;
	  }
	}
	console.log('Selected style:' + selOpt);
	
	switch(selOpt){
		case 'retro':
			div.style.backgroundImage = "url('img/old_tv.png')";
			div.style.backgroundSize = "440px 290px";
			div.style.height = "290px";
			div.style.width = "440px";
			video.style.height = "240px";
			document.getElementById('tvControlsContainer').style.width = '440px';
			document.getElementById('tvControls').style.marginTop = '-70px';
			document.getElementById('tvControls').style.marginLeft = '155px';
			document.getElementById('tvControls').style.float = 'left';
			video.style.width = "310px";
			video.style.paddingTop = "45px";
			video.style.paddingLeft = "35px";
			video.style.marginTop = "0px";
			document.body.style.background = 'url(img/colour.png) no-repeat';
			document.body.style.backgroundSize = 'cover';
			document.getElementById('radioDiv').style.background = 'rgba(255,214,94,0.8)';
			document.getElementById('radioDiv').style.padding = '5px';
			document.getElementById('radioDiv').style.margin = '5px';
			document.getElementById('radioDiv').style.borderRadius = '8px';
			document.getElementById('pageTitle').style.fontFamily = 'Pattaya';
			document.getElementById('pageTitle').style.color = '#ec2045';
			document.getElementById('pageTitle').style.textShadow = '2px 1px 0px #c7c12f';
			document.getElementById('pageTitle').classList.add('hide');
			document.getElementById('cvs_pageTitleModern').classList.add('hide');
			drawRetroTitle();
			document.getElementById('tv_back').className = 'btn button_retro';
			document.getElementById('tv_fore').className = 'btn button_retro';
			document.getElementById('tv_playpause').className = 'btn button_retro';
			break;
		case 'modern':
			div.style.backgroundImage = "url('img/flat_panel_tv.png')";
			div.style.backgroundSize = "440px 290px";
			div.style.height = "290px";
			div.style.width = "440px";
			video.style.height = "280px";
			video.style.width = "410px";
			document.getElementById('tvControlsContainer').style.width = '440px';
			document.getElementById('tvControls').style.marginTop = '-70px';
			document.getElementById('tvControls').style.marginLeft = '0px';
			document.getElementById('tvControls').style.float = 'right';
			video.style.paddingTop = "0px";
			video.style.paddingLeft = "15px";
			video.style.marginTop = "-20px";
			document.body.style.background = 'url(img/waves.jpg) no-repeat';
			document.body.style.backgroundSize = 'cover';
			document.getElementById('radioDiv').style.background = 'rgba(255, 255, 255, 0.8)';
			document.getElementById('radioDiv').style.padding = '5px';
			document.getElementById('radioDiv').style.margin = '5px';
			document.getElementById('radioDiv').style.borderRadius = '8px';
			document.getElementById('pageTitle').style.fontFamily = 'Sarpanch';
			document.getElementById('pageTitle').style.color = '#2b5e6d';
			document.getElementById('pageTitle').style.textShadow = '5px 2px 5px #367588';
			document.getElementById('pageTitle').classList.add('hide');
			document.getElementById('cvs_pageTitleRetro').classList.add('hide');
			document.getElementById('tv_back').className = 'btn btn-1 btn-modern';
			document.getElementById('tv_fore').className = 'btn btn-1 btn-modern';
			document.getElementById('tv_playpause').className = 'btn btn-1 btn-modern';
			drawModernTitle();
			break;
		default:
			div.style.backgroundImage = '';
			div.style.backgroundSize = "440px 290px";
			div.style.height = "290px";
			div.style.width = "440px";
			video.style.height = "360px";
			video.style.width = "640px";
			video.style.paddingTop = "0px";
			video.style.paddingLeft = "0px";
			video.style.marginTop = "0px";
			document.body.style.background = '';
			document.getElementById('radioDiv').style.background = 'rgba(255, 255, 255, 0.8)';
			document.getElementById('radioDiv').style.padding = '5px';
			document.getElementById('radioDiv').style.margin = '5px';
			document.getElementById('radioDiv').style.borderRadius = '8px';
			document.getElementById('pageTitle').style.fontFamily = '"Times New Roman", Times, serif';
			document.getElementById('pageTitle').style.color = '#000000';
			document.getElementById('pageTitle').style.textShadow = '';
			document.getElementById('pageTitle').classList.remove('hide');
			document.getElementById('cvs_pageTitleRetro').classList.add('hide');
			document.getElementById('cvs_pageTitleModern').classList.add('hide');
			document.getElementById('tv_back').className = '';
			document.getElementById('tv_fore').className = '';
			document.getElementById('tv_playpause').className = '';
			document.getElementById('tvControls').style.float = 'right';
			document.getElementById('tvControlsContainer').style.width = '640px';
			document.getElementById('tvControls').style.marginTop = '0px';
			document.getElementById('tvControls').style.marginLeft = '0px';
	}
}

function drawRetroTitle(){
	var title1 = 'Topics: 7 - CSS3 using JS';
	var title2 = '& 10 - HTML5 tags for media';
	var can = document.getElementById('cvs_pageTitleRetro');
	var ctx = can.getContext('2d');
	
	ctx.clearRect(0, 0, can.width, can.height);

	drawStroked(ctx, title1, 50, 50, "50px 'Pattaya'", '#ff7f27', '#ec2045');
	drawStroked(ctx, title2, 10, 100, "50px 'Pattaya'", '#ff7f27', '#ec2045');
	
	document.getElementById('cvs_pageTitleRetro').classList.remove('hide');
}

function drawModernTitle() {
	document.getElementById('cvs_pageTitleModern').classList.remove('hide');
}

function drawStroked(ctx, text, x, y, font, fillStyle, strokeStyle) {
				ctx.font = font;
				ctx.strokeStyle = strokeStyle;
				ctx.lineWidth = 5;
				ctx.strokeText(text, x, y);
				ctx.fillStyle = fillStyle;
				ctx.fillText(text, x, y);
			}

function playPause() { 
	var video = document.getElementById('videoPlayer');
	  if (video.paused){
		video.play(); 
		}
	  else {
		video.pause(); 
	}
} 

function changeChannel(isForward) {
	var video = document.getElementById('videoPlayer');
	var mp4source = document.getElementById('mp4Source');
	var currentChannel =  parseInt(document.getElementById('channelNumber').value);
	var nextChannel = 0;
	if(isForward) {
		nextChannel = (currentChannel < programs.length - 1) ? currentChannel + 1 : 0;
	}
	else {
		nextChannel = (currentChannel == 0) ? programs.length - 1 : currentChannel - 1;
	}
	document.getElementById('channelNumber').value = nextChannel;
	
   var filename = programs[nextChannel];
   mp4source.src = filename;
   video.load();
   video.play();
}


//canvas -- swirling particles that will draw and swirl in relation to the mouse-click
//will exist behind the page title, so will draw the page title text in canvas as well
(function(w) {

    var canvas, ctx;
    
	//associative array to maintain status of the mouse cursor
	//to redraw particles in rlation to mouse
    var mouse = {
        x: 0,
        y: 0,
        px: 0,
        py: 0,
        down: false
    };

    var canvas_width = 600;
    var canvas_height = 125;
    var resolution = 5;
    var pen_size = 40;

    var num_cols = canvas_width / resolution;
    var num_rows = canvas_height / resolution;
    var particle_count = 5000;
    
    var vec_cells = [];
    var particles = [];


    function init() {
        
        //draw as part of the "modern" view page title
        canvas = document.getElementById("cvs_pageTitleModern");
        ctx = canvas.getContext("2d");
        canvas.width = canvas_width;
        canvas.height = canvas_height;

        for (i = 0; i < particle_count; i++) {
            particles.push(new particle(Math.random() * canvas_width, Math.random() * canvas_height));
        }

        for (col = 0; col < num_cols; col++) { 
            vec_cells[col] = [];

            for (row = 0; row < num_rows; row++) {
                var cell_data = new cell(col * resolution, row * resolution, resolution)
                vec_cells[col][row] = cell_data;
                vec_cells[col][row].col = col;
                vec_cells[col][row].row = row;

            }
        }
        
        for (col = 0; col < num_cols; col++) {          
            for (row = 0; row < num_rows; row++) { 
                var cell_data = vec_cells[col][row];
                var row_up = (row - 1 >= 0) ? row - 1 : num_rows - 1;
                var col_left = (col - 1 >= 0) ? col - 1 : num_cols - 1;
                var col_right = (col + 1 < num_cols) ? col + 1 : 0;

                var up = vec_cells[col][row_up];
                var left = vec_cells[col_left][row];
                var up_left = vec_cells[col_left][row_up];
                var up_right = vec_cells[col_right][row_up];
                
                cell_data.up = up;
                cell_data.left = left;
                cell_data.up_left = up_left;
                cell_data.up_right = up_right;

                up.down = vec_cells[col][row];
                left.right = vec_cells[col][row];
                up_left.down_right = vec_cells[col][row];
                up_right.down_left = vec_cells[col][row];
            }
        }

		//event listeners
        w.addEventListener("mousedown", mouse_down_handler);
        w.addEventListener("touchstart", mouse_down_handler);
        w.addEventListener("mouseup", mouse_up_handler);
        w.addEventListener("touchend", touch_end_handler);
        canvas.addEventListener("mousemove", mouse_move_handler);
        canvas.addEventListener("touchmove", touch_move_handler);

        w.onload = draw;
    }

    function update_particle() {

        //Loops through all of the particles in the array
        for (i = 0; i < particles.length; i++) {
            var p = particles[i];

            if (p.x >= 0 && p.x < canvas_width && p.y >= 0 && p.y < canvas_height) {
                var col = parseInt(p.x / resolution);
                var row = parseInt(p.y / resolution);
                var cell_data = vec_cells[col][row];

                var ax = (p.x % resolution) / resolution;
                var ay = (p.y % resolution) / resolution;
                
                p.xv += (1 - ax) * cell_data.xv * 0.05;
                p.yv += (1 - ay) * cell_data.yv * 0.05;

                p.xv += ax * cell_data.right.xv * 0.05;
                p.yv += ax * cell_data.right.yv * 0.05;
                
                p.xv += ay * cell_data.down.xv * 0.05;
                p.yv += ay * cell_data.down.yv * 0.05;
                
                p.x += p.xv;
                p.y += p.yv;
                
                var dx = p.px - p.x;
                var dy = p.py - p.y;

                //distance the particle travelled.
                var dist = Math.sqrt(dx * dx + dy * dy);
               
                var limit = Math.random() * 0.5;
                
                if (dist > limit) {
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(p.x, p.y);
                    ctx.lineTo(p.px, p.py);
                    ctx.stroke();
                }else{
                    ctx.beginPath();
                    ctx.moveTo(p.x, p.y);
                    ctx.lineTo(p.x + limit, p.y + limit);
                    ctx.stroke();
                }
                p.px = p.x;
                p.py = p.y;
            }
            else {
                //If the particle's X and Y coordinates are outside the bounds of the canvas...
                //Place the particle at a random location on the canvas
                p.x = p.px = Math.random() * canvas_width;
                p.y = p.py = Math.random() * canvas_height;
                p.xv = 0;
                p.yv = 0;
            } 
            //slow velocity over time
            p.xv *= 0.5;
            p.yv *= 0.5;
        }
    }

    function draw() {
        var mouse_xv = mouse.x - mouse.px;
        var mouse_yv = mouse.y - mouse.py;
        
        for (i = 0; i < vec_cells.length; i++) {
            var cell_datas = vec_cells[i];

            for (j = 0; j < cell_datas.length; j++) {
                var cell_data = cell_datas[j];
                
                if (mouse.down) {
                    change_cell_velocity(cell_data, mouse_xv, mouse_yv, pen_size);
                }

                update_pressure(cell_data);
            }
        }
        
		//clear canvas between frames, so particles move
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        update_particle();
		
		//add text to make canvas page title
		var title1 = 'Topics: 7 - CSS3 using JS & 10 - HTML5 tags for media';
		canvas = document.getElementById("cvs_pageTitleModern");
		ctx = canvas.getContext("2d");
		
		// Create gradient (for text outline and for particle colors)
		var gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
		gradient.addColorStop("0"," #ac60fe");
		gradient.addColorStop("0.5", "#8ee3ff");
		gradient.addColorStop("1.0", "#3f48cc");
		//draw text
		drawStroked(ctx, title1, 10, 90, "55px 'Six Caps'", '#ffffff', gradient);

        //set color for particles
        ctx.strokeStyle = gradient;

        for (i = 0; i < vec_cells.length; i++) {
            var cell_datas = vec_cells[i];

            for (j = 0; j < cell_datas.length; j++) {
                var cell_data = cell_datas[j];
                update_velocity(cell_data);
            }
        }
        
        //update previous mouse coordinates with the current ones for the next frame.
        mouse.px = mouse.x;
        mouse.py = mouse.y;

        //draw next animation frame
        requestAnimationFrame(draw);

    }

    function change_cell_velocity(cell_data, mvelX, mvelY, pen_size) {
        //This gets the distance between the cell and the mouse cursor.
        var dx = cell_data.x - mouse.x;
        var dy = cell_data.y - mouse.y;
        var dist = Math.sqrt(dy * dy + dx * dx);
        
        //If the distance is less than the radius...
        if (dist < pen_size) {

            //If the distance is very small, set it to the pen_size.
            if (dist < 4) {
                dist = pen_size;
            }
            
            //Calculate the magnitude of the mouse's effect (closer is stronger)
            var power = pen_size / dist;

            /*
            Apply the velocity to the cell by multiplying the power by the mouse velocity and adding it to the cell velocity
            */
            cell_data.xv += mvelX * power;
            cell_data.yv += mvelY * power;
        }
    }
    
    function update_pressure(cell_data) {

        var pressure_x = (
            cell_data.up_left.xv * 0.5
            + cell_data.left.xv
            + cell_data.down_left.xv * 0.5
            - cell_data.up_right.xv * 0.5
            - cell_data.right.xv
            - cell_data.down_right.xv * 0.5
        );
        
        var pressure_y = (
            cell_data.up_left.yv * 0.5
            + cell_data.up.yv
            + cell_data.up_right.yv * 0.5
            - cell_data.down_left.yv * 0.5
            - cell_data.down.yv
            - cell_data.down_right.yv * 0.5
        );
        cell_data.pressure = (pressure_x + pressure_y) * 0.25;
    }
    
    function update_velocity(cell_data) {
        cell_data.xv += (
            cell_data.up_left.pressure * 0.5
            + cell_data.left.pressure
            + cell_data.down_left.pressure * 0.5
            - cell_data.up_right.pressure * 0.5
            - cell_data.right.pressure
            - cell_data.down_right.pressure * 0.5
        ) * 0.25;
        
        cell_data.yv += (
            cell_data.up_left.pressure * 0.5
            + cell_data.up.pressure
            + cell_data.up_right.pressure * 0.5
            - cell_data.down_left.pressure * 0.5
            - cell_data.down.pressure
            - cell_data.down_right.pressure * 0.5
        ) * 0.25;
        
        cell_data.xv *= 0.99;
        cell_data.yv *= 0.99;
    }

    function cell(x, y, res) {
        //cell position
        this.x = x;
        this.y = y;
        
        //cell width/height
        this.r = res;

        this.col = 0;
        this.row = 0;
        
        this.xv = 0;
        this.yv = 0;

        this.pressure = 0;
    }

    function particle(x, y) {
        this.x = this.px = x;
        this.y = this.py = y;
        this.xv = this.yv = 0;
    }

    function mouse_down_handler(e) {
        e.preventDefault();
        mouse.down = true;
    }

    function mouse_up_handler() {
        mouse.down = false; 
    }
    
    function touch_end_handler(e) {
        if (!e.touches) mouse.down = false;
    }

    function mouse_move_handler(e) {
        //Saves the previous coordinates
        mouse.px = mouse.x;
        mouse.py = mouse.y;

        //Sets the new coordinates
        mouse.x = e.offsetX || e.layerX;
        mouse.y = e.offsetY || e.layerY;
    }

    function touch_move_handler(e) {        
        mouse.px = mouse.x;
        mouse.py = mouse.y;
        var rect = canvas.getBoundingClientRect();
        mouse.x = e.touches[0].pageX - rect.left;
        mouse.y = e.touches[0].pageY - rect.top;
    }

    w.Fluid = {
        initialize: init
    }

}(window)); //Passes "window" into the self-invoking function.

window.requestAnimationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame;
Fluid.initialize();
</script>
</body>

</html> 
