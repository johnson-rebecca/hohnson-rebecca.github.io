<!DOCTYPE html>
<html>
<head>
	<title>JS Objects, JSON, AJAX, &amp; Local Storage</title>
	<link href='https://fonts.googleapis.com/css?family=Aclonica' rel='stylesheet'>
	<link href='https://fonts.googleapis.com/css?family=Advent Pro' rel='stylesheet'>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
.pincontainer {
	border: 1px solid #333333;
	border-radius:5px;
	padding: 2px;
	margin: 5px;
	display: inline-table;
	width: 350px;
	text-align: center;
	font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
	font-size: 11px;
	font-weight:bold;
}
.insetshadow {
   -moz-box-shadow:    inset 0 0 10px #C0C0C0;
   -webkit-box-shadow: inset 0 0 10px #C0C0C0;
   box-shadow:         inset 0 0 10px #C0C0C0;
}
.imgpin {
	width: 150px;
	text-align: center;
}
h1 {
	text-align: center;
}
/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content/Box */
.modal-content {
  background-color: #b5dda4;
  margin: 15% auto; /* 15% from the top and centered */
  padding: 20px;
  border: 1px solid #888;
  border-radius:15px;
  width: 20%; /* Could be more or less, depending on screen size */
  min-width: 300px;
  max-width: 500px;
  padding-bottom:35px;
}

/* The Close Button */
 .close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}
.modal-hide {
	display:none;
}

 .close:hover,
 .close:focus {
  color: #0B70A4;
  text-decoration: none;
  cursor: pointer;
} 
.switch {
  position: relative;
  display: inline-block;
  width: 40px;
  height: 23px;
}

.switch input { 
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  -webkit-transition: .4s;
  transition: .4s;
}

.slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  -webkit-transition: .4s;
  transition: .4s;
}

input:checked + .slider {
  background-color: #0B70A4;
}

input:focus + .slider {
  box-shadow: 0 0 1px #0B70A4;
}

input:checked + .slider:before {
  -webkit-transform: translateX(16px);
  -ms-transform: translateX(16px);
  transform: translateX(16px);
}

/* Rounded sliders */
.slider.round {
  border-radius: 36px;
}

.slider.round:before {
  border-radius: 50%;
}

.welcome {
font-family: 'Aclonica';
font-size: 22px;
text-align: center;
color: #754668;
}
.label {
	font-family: 'Advent Pro';
	font-size: 12px;
	font-weight:bold;
	color: #0B70A4;
	/*#587d71; --drk grn color*/
}
.modalInput {
	border-radius:5px;
}
.inputRow {
	padding-top:5px;
}
.modalButton {
	font-family: 'Advent Pro';
	font-size: 16px;
	font-weight:bold;
	color: #0B70A4;
	float:right;
	position: relative;
}
.modalButtonInactive {
	color: silver;
}
.highlight-disabled {
	background-color: #D2D7D3;
	-webkit-transition: background-color 1s ease-in-out; /* Safari */
	transition: background-color 1s ease-in-out;
}
#addUserForm {
	background-color: #dcebed;
	border-radius: 10px;
	padding: 10px;
}
.highlight {
	background-color: #ffffff;
	-webkit-transition: background-color 1s ease-in-out; /* Safari */
	transition: background-color 1s ease-in-out;
	-webkit-transition: border 1s ease-in-out; /* Safari */
	transition: border 1s ease-in-out;
	border: 1px solid #D2D7D3;
}
.error {
	border: 1px solid red;
	box-shadow: 0px 0px 10px #8b0000;
}
#addUserForm {
	-webkit-transition: opacity 2s linear;
	transition: opacity 2s linear;
	margin: 5px;
}
.hidden {
	opacity: 0;
}
.fa-check-circle {
	color: green;
	font-size:14px;
}
.fa-times-circle {
	color: red;
	font-size:14px;
}
@keyframes wiggle {
    0% { transform: rotate(0deg); }
   80% { transform: rotate(0deg); }
   85% { transform: rotate(5deg); }
   95% { transform: rotate(-5deg); }
  100% { transform: rotate(0deg); }
}
.fa-star {
	color: #c2dd90;
	-webkit-transition: opacity 2s linear;
	transition: opacity 2s linear;
	animation: wiggle 2.5s infinite;
}
.hide {
	display: none;
}
.highlight-select {
	background-color: #ffffff;
	-webkit-transition: background-color 3s linear; /* Safari */
	transition: background-color 3s linear;
	-webkit-transition: border 5s linear; /* Safari */
	transition: border 5s linear;
	border: 1px solid #D2D7D3;
	border-radius: 5px;
}


</style>
</head>
<body>
<h1>Topics: 2 - JS Objects, 3 - JSON, 4 - AJAX, &amp; 5 - Local Storage</h1>
<select id="selectUser" class="highlight-select">
    <option>- Choose a User-</option>
</select>
<i id="ListUpdated" class="fa fa-star hidden"></i>
<input type="button" value="View Pinterest Info" onclick="LoadJSON();"/>
<input id="btnAddUser" type="button" value="Add Name to List" />
<div id="addUserForm" class="hidden">
	<span class="label">First name:</span>
	<input id="txtAddFirstname" class="modalInput highlight" type="text" size="25" maxlength = "50" placeholder="" value="" required/>
	<span class="label">Last name:</span>
	<input id="txtAddLastname" class="modalInput highlight" type="text" size="25" maxlength = "50" placeholder="" value="" required/>
	<span class="label">Pinterest Id:</span>
	<input id="txtAddPinterestId" class="modalInput highlight" type="text" size="25" maxlength = "50" placeholder="" value="" required/>
	<i id="PinterestId_valid" class="fa fa-check-circle hide"></i>
	<i id="PinterestId_invalid" class="fa fa-times-circle hide"></i>
	<span class="label">Board Name:</span>
	<input id="txtAddBoard" class="modalInput highlight" type="text" size="25" maxlength = "50" placeholder="" value="" required/>
	<i id="Board_valid" class="fa fa-check-circle hide"></i>
	<i id="Board_invalid" class="fa fa-times-circle hide"></i>
	<input type="button" value="Update List" onclick="validateAdd();"/>
</div>

<div id="displayPins"></div>

<!-- The Modal -->
<div id="myModal" class="modal">



  <!-- Modal content -->
  <div class="modal-content">
    <!--<span class="close">&times;</span>-->
	<div class="welcome">Welcome!</div>
 	<div class="inputRow">
	<span class="label">Enable Local Data Saving:</span>
	<label class="switch">
	  <input id="chkAllowSave" type="checkbox" onchange="changeSave(this);">
	  <span class="slider round"></span></label>
  </div>
  
	<div id="divNameRow" class="inputRow">
		<span class="label">Your name:</span>
		<input id="txtUsername" class="modalInput highlight-disabled" type="text" size="33" maxlength = "50" disabled="disabled" placeholder="" value=""/>
	</div>
	<input id="btnSubmit" class="modalButton" type="button" value="Submit" onclick="SubmitModal();" />
	
  </div>

</div>

<script>
var ALLOW_SAVE = false;
var USERNAME = '';
var listUsers = [];
var savedPageUsers = [];
window.addEventListener("load", loadPage);

// define object to save Pinterest users for viewing boards
function PinterestUserBoard(firstname, lastname, id, boardname)  {
    this.firstname = firstname;
    this.lastname =  lastname;
	this.id = id;
    this.boardname = boardname;
	this.displayname = function() {return this.lastname + ", " + this.firstname;};
}

//define page user object
function pageUser(username, dateSaved, users, jsonresults) {
	this.username = username;
	this.dateSaved = dateSaved;
	this.users = users;
	this.jsonresults = jsonresults;
}

document.getElementById('txtUsername').addEventListener('input', (evt) => {
var modalUN =  document.getElementById('txtUsername');
	var modalBtn = document.getElementById('btnSubmit');
  if(document.getElementById('txtUsername').value.length > 1){
		modalBtn.disabled = false;
		modalBtn.classList.remove('modalButtonInactive');
		modalUN.style.backgroundColor = '#D2D7D3';
  }
  else {
		modalUN.style.backgroundColor = '#e8dab2';
		modalBtn.disabled = true;
		modalBtn.classList.add("modalButtonInactive");
  }
});

document.getElementById('btnAddUser').addEventListener('click', (evt) => {
	var formDiv = document.getElementById('addUserForm');
	formDiv.classList.remove('hidden');
});

function loadPage(){
	//display modal
	var modal = document.getElementById("myModal");
	fadeIn(modal);
	
	buildStandardListUsers();
	sortListUsers;
	buildUserListSelect();
	 
	//stringify users object
	//var obj = JSON.stringify(listUsers);
	//console.log('Stringified Array of PinterestUserBoard Objects');
	//console.log(obj);


}

function buildStandardListUsers(){
	//build standard list of Pinterest usernames
	listUsers.push(new PinterestUserBoard('Cindy', 'Whiting', 'cindywhiting138', 'christmas'));
	listUsers.push(new PinterestUserBoard('Catherine', 'Poole', 'koneechee', 'christmas-decor'));
	listUsers.push(new PinterestUserBoard('Rebecca', 'Johnson', 'liralin', 'christmas-ideas'));
	listUsers.push(new PinterestUserBoard('Sarah', 'Van Wagoner', 'sarahvanwagoner4', 'christmas'));
	listUsers.push(new PinterestUserBoard('Brittany', 'Morgan', 'brittnkatie', 'christmas-time-is-here'));
	listUsers.push(new PinterestUserBoard('Hannah', 'Davenport', 'pinned4life', 'christmas'));
	listUsers.push(new PinterestUserBoard('Emily', 'Baier', 'musicebaier', 'christmas'));
}

function buildUserListSelect(){
	var select = document.getElementById("selectUser");
	//loop through array to build dropdown using DOM manipulation
	for(var i = 0; i < listUsers.length; i++) {
		var el = document.createElement("option");
		el.textContent = listUsers[i].displayname();
		el.value = i;
		select.appendChild(el);
	}	
}

function sortListUsers(){
	//sort users based on displayname
	listUsers.sort(function(a, b) {
		var textA = a.displayname().toUpperCase();
		var textB = b.displayname().toUpperCase();
		return (textA < textB) ? -1 : (textA > textB) ? 1 : 0;
	});
}

function changeSave(chk){
	var modalUN =  document.getElementById('txtUsername');
	var modalBtn = document.getElementById('btnSubmit');
	if(chk.checked){
		modalUN.disabled = false;
		modalUN.placeholder = "Enter your name to enable saving";
		modalUN.style.backgroundColor = '#e8dab2'; //will trigger css animation
		modalBtn.disabled = true;
		modalBtn.classList.add("modalButtonInactive");
	}
	else {
		modalUN.disabled = true;
		modalUN.placeholder = "";
		modalUN.style.backgroundColor = '#D2D7D3'; //will trigger css animation
		modalUN.value = '';
		modalBtn.disabled = false;
		modalBtn.classList.remove("modalButtonInactive");		
	}
}

//fade in
function fadeIn(el, display){
  el.style.opacity = 0;
  el.style.display = display || "block";

  (function fade() {
    var val = parseFloat(el.style.opacity);
    if (!((val += .1) > 1)) {
      el.style.opacity = val;
      requestAnimationFrame(fade);
    }
  })();
}

// fade out
function fadeOut(el){
  el.style.opacity = 1;

  (function fade() {
    if ((el.style.opacity -= .1) < 0) {
      el.style.display = "none";
    } else {
      requestAnimationFrame(fade);
    }
  })();
}

function highlightFor(id,color,seconds){
    var element = document.getElementById(id)
    var origcolor = element.style.backgroundColor
    element.style.backgroundColor = color;
    var t = setTimeout(function(){
       element.style.backgroundColor = origcolor;
    },(seconds*1000));
}


function SubmitModal(){
	var modalUN =  document.getElementById('txtUsername');
	var modalChk = document.getElementById('chkAllowSave');
	var modal = document.getElementById("myModal");
	if(modalChk.checked){
		ALLOW_SAVE = true;
		USERNAME = modalUN.value;
	}
	else {
		ALLOW_SAVE = false;
		USERNAME = '';
	}
	//console.log('allowSave:' + ALLOW_SAVE + ' , Uname:' + USERNAME);
	fadeOut(modal);
}

 
//build up pin result display
function displayPins(data){
	var html = "";
	for(var i = 0; i < data.length; i++) {
		var obj = data[i];
		var imgObj = obj.images;
		html += "<div class='pincontainer insetshadow'>";
		if(obj.link){
			html += "<a target='_blank' href='" + obj.link + "'/>";
		}
		html += "<img class='imgpin' src='" + obj.images["237x"].url +"'/>";
		if(obj.link){
		html +=  "</a>";
		}
		html += "<br/>" + obj.description;
		html += "</div>";

	}
	return html;
}

function getJSONFile(path, callback) {
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {
                var data = JSON.parse(xhr.responseText);
                if (callback) callback(data);
            }
        }
    };
    xhr.open('GET', path, true);
    xhr.send(); 
}

function getJSONFileForValidation(path, callback) {
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            //if (xhr.status === 200) {
                var status = xhr.status;
                if (callback) callback(status);
            //}
        }
    };
    xhr.open('GET', path, true);
    xhr.send(); 
}

function LoadJSON(){
// this requests the file and executes a callback with the parsed result once
//   it is available
//	get selected user
	var e = document.getElementById("selectUser");
	var selIndex = e.options[e.selectedIndex].value;
	var user = listUsers[selIndex].id;
	var board = listUsers[selIndex].boardname;
	var div = document.getElementById('displayPins');
	
	getJSONFile('https://api.pinterest.com/v3/pidgets/boards/' + user  + '/' + board + '/pins/', function(json){
		div.innerHTML = displayPins(json.data.pins);
		console.log(json);
	});

}

function refreshPinterestUserList(){
	var select = document.getElementById('selectUser');
	sortListUsers();
	
	//clear existing list
	while (select.lastChild.value != select.firstChild.value) {
		select.removeChild(select.lastChild);
	}
	
	buildUserListSelect();
	select.style.borderColor = '#c2dd90';
	setTimeout(function(){ select.style.borderColor  = '#D2D7D3'; }, 3000);
}

function validateAdd(){
	var errorCount = 0;
	var firstname = document.getElementById('txtAddFirstname');
	var lastname = document.getElementById('txtAddLastname');
	var pinId = document.getElementById('txtAddPinterestId');
	var board = document.getElementById('txtAddBoard');

	if(firstname.value.length < 1) {
		firstname.classList.add('error');
		errorCount ++;
	}
	if(lastname.value.length < 1) {
		lastname.classList.add('error');
		errorCount ++;
	}
	if(pinId.value.length < 1) {
		pinId.classList.add('error');
		errorCount ++;
	}
	if(board.value.length < 1) {
		board.classList.add('error');
		errorCount ++;
	}
	if(errorCount == 0) {
		//check json to validatepinterest user	
		getJSONFileForValidation('https://api.pinterest.com/v3/pidgets/users/' + pinId.value  + '/pins/', function(status){
			if(status == 200){
				document.getElementById('PinterestId_valid').classList.remove('hide');
				document.getElementById('PinterestId_invalid').classList.add('hide');
				
				//user passed successfully, so now we need to check for user's board
				getJSONFileForValidation('https://api.pinterest.com/v3/pidgets/boards/' + pinId.value  + '/' + board.value + '/pins/', function(board_status){
					if(board_status == 200){
						document.getElementById('Board_valid').classList.remove('hide');
						document.getElementById('Board_invalid').classList.add('hide');
						
						//board also passed successfully, so if we make it to here, name will be pushed to object containg PinterestUserBoard data// and dropdown will be refreshed
						//animate to show dropdown updated
						listUsers.push(new PinterestUserBoard(firstname.value, lastname.value, pinId.value, board.value)); //add to list of objects
						refreshPinterestUserList();
					}
					else { // json for board did not return successfully, so invalid board for user
						document.getElementById('Board_valid').classList.add('hide');
						document.getElementById('Board_invalid').classList.remove('hide');
					}
				});
				
			}
			else { // json did not return successfully, so invalid user
				document.getElementById('PinterestId_valid').classList.add('hide');
				document.getElementById('PinterestId_invalid').classList.remove('hide');
				errorCount++;				
			}
			
		});
	}
	// add error message (review bootstrappy error msgs to mimic
	//validate against duplicate
	//wiggle error msgs

	//if not display error
	//if valid clear form, add data to dropdown and vissually highlight dropdown
	//save dropdown
}
</script>
</body>
</html> 