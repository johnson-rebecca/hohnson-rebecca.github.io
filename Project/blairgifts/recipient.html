<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Recipient - Blair Family Gift Exchange Helper</title>

  <link rel="stylesheet" href="assets/css/main.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
<style>
.status_section{
	text-align:left;
}
.package {
	display:inline-block;
	background-image: url("assets/images/cardboard-box.png");
	background-size: contain;
	background-repeat: no-repeat;
	color:#fff;
	margin-left:5px;
	height:50px;
	width:50px;
	vertical-align: middle;
	font-weight:bold;
	text-align:center;
	line-height:50px;
	font-size: 1.2rem
}
.inlineblock {
	display:inline-block;
}
.package div {
}
	
#xmas_countdown {
	margin-top:30px;
  width: 130px;
  text-align: center;
  position: relative;
  border: 2px #61AD65 solid;
  border-radius: 3px;
  background: white;
  font-weight: 600;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.16), 0 2px 3px rgba(0, 0, 0, 0.12);
}
#xmas_countdown svg {
  width: 130px;
  position: absolute;
  top: -40px;
  left: 0;
}
#xmas_countdown svg .st5 {
  fill: #C13D2C;
}
#xmas_countdown svg .st6 {
  fill: #E64E3D;
}
#xmas_countdown #message {
  font-size: 1.03rem;
  line-height:1.01rem;
  background: #61AD65;
  color: white;
  text-transform: uppercase;
  padding: 5px 0;
  text-shadow: 1px 1px 1px #5A5A5A;
}
#xmas_countdown #countdown {
  font-size: 2.4rem;
  color: #E64E3D;
  line-height: 1em;
}
#daystilShipDue {
	display:inline-block;
}
.shippingnear {
	color:
}

.heartbeat {
	-webkit-animation: heartbeat 1.5s ease-in-out infinite both;
	        animation: heartbeat 1.5s ease-in-out infinite both;
}

.ping {
	-webkit-animation: ping 0.8s ease-in-out infinite both;
	        animation: ping 0.8s ease-in-out infinite both;
}

/**
 * ----------------------------------------
 * animation heartbeat
 * ----------------------------------------
 */
@-webkit-keyframes heartbeat {
  from {
    -webkit-transform: scale(1);
            transform: scale(1);
    -webkit-transform-origin: center center;
            transform-origin: center center;
    -webkit-animation-timing-function: ease-out;
            animation-timing-function: ease-out;
  }
  10% {
    -webkit-transform: scale(0.91);
            transform: scale(0.91);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
  }
  17% {
    -webkit-transform: scale(0.98);
            transform: scale(0.98);
    -webkit-animation-timing-function: ease-out;
            animation-timing-function: ease-out;
  }
  33% {
    -webkit-transform: scale(0.87);
            transform: scale(0.87);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
  }
  45% {
    -webkit-transform: scale(1.5);
            transform: scale(1.5);
    -webkit-animation-timing-function: ease-out;
            animation-timing-function: ease-out;
  }
}
@keyframes heartbeat {
  from {
    -webkit-transform: scale(1);
            transform: scale(1);
    -webkit-transform-origin: center center;
            transform-origin: center center;
    -webkit-animation-timing-function: ease-out;
            animation-timing-function: ease-out;
  }
  10% {
    -webkit-transform: scale(0.91);
            transform: scale(0.91);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
  }
  17% {
    -webkit-transform: scale(0.98);
            transform: scale(0.98);
    -webkit-animation-timing-function: ease-out;
            animation-timing-function: ease-out;
  }
  33% {
    -webkit-transform: scale(0.87);
            transform: scale(0.87);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
  }
  45% {
    -webkit-transform: scale(1.5);
            transform: scale(1.5);
    -webkit-animation-timing-function: ease-out;
            animation-timing-function: ease-out;
  }
}

/**
 * ----------------------------------------
 * animation ping
 * ----------------------------------------
 */
@-webkit-keyframes ping {
  0% {
    -webkit-transform: scale(0.2);
            transform: scale(0.2);
    opacity: 1;
  }
  80% {
    -webkit-transform: scale(1.2);
            transform: scale(1.2);
    opacity: .3;
  }
  100% {
    -webkit-transform: scale(2.2);
            transform: scale(2.2);
    opacity: 0;
  }
}
@keyframes ping {
  0% {
    -webkit-transform: scale(0.2);
            transform: scale(0.2);
    opacity: 1;
  }
  80% {
    -webkit-transform: scale(1.2);
            transform: scale(1.2);
    opacity: 0.3;
  }
  100% {
    -webkit-transform: scale(2.2);
            transform: scale(2.2);
    opacity: 0;
  }
}

.scale-down {
	-webkit-animation: scale-down 0.4s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
	        animation: scale-down 0.4s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
}

.scale-up {
	-webkit-animation: scale-up 0.4s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
	        animation: scale-up 0.4s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
}

#authenticated {
    -webkit-transform: scale(1);
            transform: scale(1);
}

#unauthenticated {
    -webkit-transform: scale(0);
            transform: scale(0);
			   height: 0;
		   margin-top: 0;
		margin-bottom: 0;
}

/**
 * ----------------------------------------
 * animation scale-down
 * ----------------------------------------
 */
@-webkit-keyframes scale-down {
  0% {
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  100% {
    -webkit-transform: scale(0);
            transform: scale(0);
			   height: 0;
		   margin-top: 0;
		margin-bottom: 0;
  }
}
@keyframes scale-down {
  0% {
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  100% {
    -webkit-transform: scale(0);
            transform: scale(0);
			   height: 0;
		   margin-top: 0;
		margin-bottom: 0;
  }
}

/**
 * ----------------------------------------
 * animation scale-up
 * ----------------------------------------
 */
@-webkit-keyframes scale-up {
  0% {
    -webkit-transform: scale(0);
            transform: scale(0);
  }
  100% {
    -webkit-transform: scale(1);
            transform: scale(1);
  }
}
@keyframes scale-up {
  0% {
    -webkit-transform: scale(0);
            transform: scale(0);
  }
  100% {
    -webkit-transform: scale(1);
            transform: scale(1);
  }
}

.lnkLogout {
	font-size: .75rem;
}
.welcome {
	font-size: .8rem;
	display:inline-block;
	text-align:center;
}

#welcomeUser {
	font-weight: bold;
	display:inline;
}

.icon-save:before {
	content: "\f0c7";
	font-weight:400;
}
.hiddenDiv {
	max-height:0px;
	opacity:0;
	width: 30rem;
	transition: all 2s ease-in-out;
}
.revealDiv {
	max-height:200px;
	opacity:1;
}


/* Success and error */

.btnsuccess,
.btnerror {
	color: transparent;
}

.btnsuccess:after,
.btnerror:after {
	z-index: 1;
	color: #fff !important;
	left: 40%;
}

.btnsuccess:before {
	content: "\f580";
}

.btnsuccess:after {
	content: "Success!";
	-webkit-animation: moveUp 0.5s;
	-moz-animation: moveUp 0.5s;
	animation: moveUp 0.5s;
}

@-webkit-keyframes moveUp {
	0% {
		-webkit-transform: translateY(50%);
		opacity: 0;
	}
	100% { 
		opacity: 1;
		-webkit-transform: translateY(0);
	}
}

@-moz-keyframes moveUp {
	0% {
		-moz-transform: translateY(50%);
		opacity: 0;
	}
	100% { 
		opacity: 1;
		-moz-transform: translateY(0);
	}
}

@keyframes moveUp {
	0% {
		transform: translateY(50%);
		opacity: 0;
	}
	100% { 
		opacity: 1;
		transform: translateY(0);
	}
}
.btnerror {
	-webkit-animation: shake 0.5s;
	-moz-animation: shake 0.5s;
	animation: shake 0.5s;
}

/* From Dan Eden's animate.css: http://daneden.me/animate/ */
@-webkit-keyframes shake {
	0%, 100% {-webkit-transform: translateX(0);}
	10%, 30%, 50%, 70%, 90% {-webkit-transform: translateX(-10px);}
	20%, 40%, 60%, 80% {-webkit-transform: translateX(10px);}
}

@-moz-keyframes shake {
	0%, 100% {-moz-transform: translateX(0);}
	10%, 30%, 50%, 70%, 90% {-moz-transform: translateX(-10px);}
	20%, 40%, 60%, 80% {-moz-transform: translateX(10px);}
}

@keyframes shake {
	0%, 100% {transform: translateX(0);}
	10%, 30%, 50%, 70%, 90% {transform: translateX(-10px);}
	20%, 40%, 60%, 80% {transform: translateX(10px);}
}

.btnerror:before {
	content: "\f119";
}

.btnerror:after {
	content: "Error!";
	-webkit-animation: scaleFromUp 0.5s;
	-moz-animation: scaleFromUp 0.5s;
	animation: scaleFromUp 0.5s;
}

@-webkit-keyframes scaleFromUp {
	0% {
		-webkit-transform: scale(0);
		opacity: 0;
	}
	100% { 
		opacity: 1;
		-webkit-transform: scale(1);
	}
}

@-moz-keyframes scaleFromUp {
	0% {
		-moz-transform: scale(0);
		opacity: 0;
	}
	100% { 
		opacity: 1;
		-moz-transform: scale(1);
	}
}

@keyframes scaleFromUp {
	0% {
		transform: scale(0);
		opacity: 0;
	}
	100% { 
		opacity: 1;
		transform: scale(1);
	}
}

</style>
<script>
var listUsers = [];
var currentProfile;

function Profile(username, giftYear, assignedRecipient, jsonresults, savedFavorites, lastSearchedUser, plannedGift, shippedDate, trackingnbr) {
	this.username = username;
	this.giftYear = giftYear;
	this.assignedRecipient = assignedRecipient;
	this.jsonresults = jsonresults;
	this.savedFavorites = savedFavorites;
	this.lastSearchedUser = lastSearchedUser;
	this.plannedGift = plannedGift;
	this.shippedDate = shippedDate;
	this.trackingnbr = trackingnbr;
}

document.addEventListener("DOMContentLoaded", function() {
	window.addEventListener("load", loadPage);
	document.getElementById("lnkLogout").addEventListener("click", logOut, false);
	document.getElementById("recipient").addEventListener("change", loadRecipientDetails, false);
	document.getElementById("giftYear").addEventListener("change", updateGiftYear, false);
	document.getElementById("giftYear").addEventListener("blur", validateGiftYear, false);
	document.getElementById("btnSave").addEventListener("click", updateProfile, false);
});

function loadPage() {
	buildStandardListUsers();
	sortListUsers();
	checkLoggedIn();
	loadForm();
	buildUserListSelect();
	loadRecipientDetails();
}

function validate(str, min, max) {
  n = parseFloat(str);
  return (!isNaN(n) && n >= min && n <= max);
}

function validateGiftYear(){
	var year = document.getElementById('giftYear').value;
	//first validate field and display error if not filled out
	if(!validate(year, 1970, 2100)) {
		//add class to username
		document.getElementById("giftYear").classList.add('error-vibrate');
		document.getElementById("giftYear").placeholder = 'Gift Year required (1970 - 2100).';
		setTimeout(function(){
			document.getElementById("giftYear").classList.remove('error-vibrate');
			document.getElementById("giftYear").placeholder = 'Enter Gift Year';
		}, 3000);
    return false;
  }
  else {
	updateGiftYear();
	return true;
  }
}

function validateRecipient(){
	var lst = document.getElementById('recipient');
	var selRecipient = lst.options[lst.selectedIndex].value;
	if(selRecipient == '' || selRecipient == '0') {
		//add class to recipient
		console.log(selRecipient);
		document.getElementById("recipient").classList.add('error-vibrate');
		setTimeout(function(){
			document.getElementById("recipient").classList.remove('error-vibrate');
		}, 3000);
		return false;
	}
	else {
		return true;
	}
}

function updateGiftYear(){
	currentProfile.giftYear = document.getElementById('giftYear').value;
}

function buildUserListSelect(){
	var select = document.getElementById("recipient");
	var selIndex = 0;
	//loop through array to build dropdown using DOM manipulation
	for(var i = 0; i < listUsers.length; i++) {
		if(currentProfile.assignedRecipient != '' && currentProfile.assignedRecipient === listUsers[i].id){
			selIndex = i + 1;
		}
		var el = document.createElement("option");
		el.textContent = listUsers[i].displayname();
		el.value = listUsers[i].id;
		select.appendChild(el);
		if(selIndex != ''){
		select.selectedIndex = selIndex;
		}
	}
}

function loadRecipientDetails() {
	var lst = document.getElementById('recipient');
	var selRecipient = lst.options[lst.selectedIndex].value;
	if (selRecipient != '0') {
		if(selRecipient != currentProfile.assignedRecipient){
			//when recipient changes, clear the saved favorites and planned gift 
			currentProfile.savedFavorites = null;
			currentProfile.plannedGift = null;
			currentProfile.lastSearchedUser = null;
		}
		currentProfile.assignedRecipient = selRecipient;
		var lstIdx = findWithAttr(listUsers, 'id', selRecipient);
		var interests = ((listUsers[lstIdx].interests != '')? listUsers[lstIdx].interests : 'no info provided');
		var colors = ((listUsers[lstIdx].colors != '')? listUsers[lstIdx].colors : 'no info provided');	
		document.getElementById('divSubjects').innerHTML = interests;
		document.getElementById('divSubjects').classList.add('revealDiv');
		document.getElementById('divColors').innerHTML = colors;
		document.getElementById('divColors').classList.add('revealDiv');
	}
}

function checkLoggedIn(){
	var username = localStorage.getItem("loggedUser");
	if(username === null){
		document.getElementById('authenticated').classList.add('scale-down');
		document.getElementById('unauthenticated').classList.add('scale-up');
	}
	if(!(username === null)){
		document.getElementById("welcomeUser").innerHTML = username;
		document.getElementById("welcomeDiv").classList.remove('hide');
	}	
}

function logOut(){
	localStorage.removeItem("loggedUser");
	document.getElementById("welcomeUser").innerHTML = '';
	document.getElementById("welcomeDiv").classList.add('hide');
	window.location.href = "index.html";
}

function loadForm(){
	var username = localStorage.getItem("loggedUser");
	var user = JSON.parse(localStorage.getItem(username));
	document.getElementById('giftYear').value = user.giftYear;
	//document.getElementById('shipped').value = user.shippedDate;
	currentProfile = user;
}

function updateProfile(){
var validYear = validateGiftYear() ;
var validSel = validateRecipient();
//validate form first -- only update if valid
//validate Date//validate recipient
if(!(validYear && validSel)) {
	//set error class on button
		document.getElementById("btnSave").classList.add('btnerror');
		setTimeout(function(){
			document.getElementById("btnSave").classList.remove('btnerror');
		}, 2000);
}
else {
		currentProfile.giftYear = document.getElementById('giftYear').value;
		var username = currentProfile.username;
		localStorage.setItem(username, JSON.stringify(currentProfile));
		document.getElementById('btnSave').classList.add('btnsuccess');
		setTimeout(function(){
			document.getElementById("btnSave").classList.remove('btnsuccess');
		}, 2000);
	}
}
</script>
</head>

<body>
  <!-- Navigation / nav-wrapper component -->
  <header class="nav-wrapper -sticky">
    <nav class="nav">
      <button class="toggle-nav" type="button">
        <div class="burger -squeeze" type="button">
          <span class="burger-lines"></span>
        </div>
      </button>
	  <div id="welcomeDiv" class="welcome hide">
		Welcome: <div id="welcomeUser">[]</div>
		<br/>
		<a id="lnkLogout" class="lnkLogout" href="#">Log Out</a>
	  </div>
      <a class="logo-link" href="index.html">
        	  <span class="fa-stack fa-lg">
		  <i class="fas fa-circle fa-stack-2x"></i>
		  <i class="fas fa-gifts fa-stack-1x fa-inverse"></i>
	  </span>
      </a>
      <ul class="nav-list" role="navigation">
        <div class="list -left">
			<li class="item">
            <a class="link" href="status.html">Status</a>
          </li>
          <li class="item">
            <a class="link -active" href="recipient.html">Recipient</a>
          </li>
		   <li class="item">
            <a class="link" href="discover.html">Discover Ideas</a>
          </li>
          <li class="item">
            <a class="link" href="favorites.html">Favorites</a>
          </li>
          <li class="item">
            <a class="link" href="gift.html">Gift</a>
          </li>
        </div>
        <div class="list -right">
          <div class="overlay"></div>
        </div>
      </ul>
    </nav>
  </header>

  <main>
  


    <section class="status_section">
		<h1>
			<i class="fas fa-holly-berry hollyLeft"></i>
			&nbsp;Recipient Ideas&nbsp;
			<i class="fas fa-holly-berry hollyRight"></i>
		</h1>
		<div id="unauthenticated">
			Login or create an account to access this page.<br/>
			Thank you.
			<a href="index.html"> - Return to login -</a>
		</div>
		<div id="authenticated">
			<label for="giftyear">Gift Year (1970 - 2100):</label>
			<input type="number" id="giftYear" min="1970" max="2100" placeholder="Enter Year"/>
			<label for="recipient">Recipient Dropdown:</label>
			<select id="recipient" class="highlight-select">
				<option value="0">- Choose a User-</option>
			</select>
			<label for="favesubjects">Subjects:</label>
			<div id="divSubjects" class="hiddenDiv">
				[Info loaded after selection made]
			</div>
			<label for="favecolors">Colors:</label>
			<div id="divColors" class="hiddenDiv">
				[Info loaded after selection made]
			</div>
			<br/>
			<button id="btnSave" class="btn btn5 btn5h icon-save">Save Profile</button>
			
			 <hr class="-major">

		</div>
	       
    </section>

  </main>
  
  <footer class="footer">

  </footer>



  <script src="assets/js/simply-nav.js"></script>
  <script src="assets/js/main.js"></script>
</body>

</html>